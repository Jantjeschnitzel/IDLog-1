<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>webapp</title>
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css styles/vendor.css -->
    <!-- bower:css -->
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css styles/main.css -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="../bower_components/datatables/media/css/jquery.dataTables.css">
    <link rel="stylesheet" href="../bower_components/datatables/media/css/jquery.dataTables_themeroller.css">
    <link rel="stylesheet" href="../bower_components/bootstrap-modal/css/bootstrap-modal.css">
    <link rel="stylesheet" href="../bower_components/bootstrap-modal/css/bootstrap-modal-bs3patch.css    ">
    <style>
        html,
        body,
        #map-canvas {
            height: 100%;
            margin: 0px;
            padding: 0px
        }
    </style>
    <!-- endbuild -->
    <!-- build:js scripts/vendor/modernizr.js -->
    <script src="/bower_components/modernizr/modernizr.js"></script>
    <!-- endbuild -->
</head>

<body>
    <!--[if lt IE 10]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <div class="container">
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">IDLog</a>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a href="/input">Home</a>
                        <li><a href="/list">Archive</a>
                        </li>                    
                    </ul>
                    <form class="navbar-form navbar-left" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search">
                        </div>
                        <button type="submit" class="btn btn-default">Submit</button>
                    </form>
                    <ul class="nav navbar-nav">
                        <li><a href="/login">login/logout</a>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container-fluid -->
        </nav>
        
        <div class="row">
            <table id="example" class="display" cellspacing="0" width="100%">
                
                
                <thead>
                    <tr>
                        <th>Firstname</th>
                        <th>Name</th>
                        <th>National number</th>
                        <th>Date of birth</th>
                        <th>Nationality</th>
                        <th>Adress</th>
                    </tr>
                </thead>

            
            </table>
            
        </div>
        <div class="footer">
            <p>IDLog team</p>
        </div>
    </div>
    <div id="map-canvas"></div>
    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    <script>
        (function (b, o, i, l, e, r) {
            b.GoogleAnalyticsObject = l;
            b[l] || (b[l] =
                function () {
                    (b[l].q = b[l].q || []).push(arguments)
                });
            b[l].l = +new Date;
            e = o.createElement(i);
            r = o.getElementsByTagName(i)[0];
            e.src = '//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e, r)
        }(window, document, 'script', 'ga'));
        ga('create', 'UA-XXXXX-X');
        ga('send', 'pageview');
    </script>
    <!-- build:js scripts/vendor.js -->
    <!-- bower:js -->
    <script src="../bower_components/modernizr/modernizr.js"></script>
    <script src="../bower_components/jquery/dist/jquery.js"></script>
    <script src="../bower_components/json3/lib/json3.js"></script>
    <script src="../bower_components/jquery.cookie/jquery.cookie.js"></script>
    <script src="../bower_components/bootstrap-modal/js/bootstrap-modal.js"></script>
    <script src="../bower_components/bootstrap-modal/js/bootstrap-modalmanager.js"></script>
    <script src="../bower_components/datatables/media/js/jquery.dataTables.js"></script>
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:js scripts/plugins.js -->
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/affix.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/alert.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/dropdown.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/tooltip.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/modal.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/transition.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/button.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/popover.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/carousel.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/scrollspy.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/collapse.js"></script>
    <script src="/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/tab.js"></script>
    <!-- endbuild -->
    <!-- build:js scripts/main.js -->
    <script src="scripts/main.js"></script>
    <!-- endbuild -->


    <script type="text/javascript">
        $(document).ready(function() {
            
        } );
        
     
        
            $.ajax({
               url: '/api/eids/',
               beforeSend:function(xhr) {
                   if ($.cookie('token')) {
                      xhr.setRequestHeader('Authorization', 'Bearer ' + $.cookie('token'));
                    }
                },
               error: function() {

               },
               dataType: 'json',
               contentType: 'application/json',
               success: function(data) {
                 $('#example').dataTable( {
                    data:data,
                    "columns": [
                        { data: "firstName" },
                        { data: "name" },
                        { data: "nationalNumber" },
                        { data: "dateOfBirth" },
                        { data: "nationality" },
                        { data: "address.streetAndNumber" }
                    ]
                });
               },
               type: 'GET'
            });

        
//        if (sessionStorage.getItem('eidData')){
//            populateForm(JSON.parse(sessionStorage.getItem('eidData')));
//        }
//      
//        
//         var eidData = {};
//        $("#btnReadId").on('click', function () {
//            var openedWindow = window.open("https://www.idlog.be:9080/eid.html");
//            window.addEventListener("message", function receiveMessage(event) {
//                if (event.origin !== "http://www.idlog.be:9000/input"){
//                    if (event.data) {
//                        eidData = event.data;  
//                        sessionStorage.setItem('eidData', JSON.stringify(eidData));
//                        populateForm(event.data);
//                    }
//                }
//            }, false);
//        });
//        function getParameterByName(name) {
//            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
//            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
//                results = regex.exec(location.search);
//            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
//        }
//        
//        var access_token = getParameterByName('access_token');
//        if (access_token){
//             document.cookie="token=" + access_token;
////            $.cookie('token',access_token);
//        }
        
        function populateForm(data){
            $('#firstName').val(data.firstName);
            $('#name').val(data.name);
            $('#middleName').val(data.middleName);
            $('#nationalNumber').val(data.nationalNumber);
            $('#dateOfBirth').val(data.dateOfBirth);
            $('#placeOfBirth').val(data.placeOfBirth);
            $('#nationality').val(data.nationality);
            $('#streetAndNumber').val(data.address.streetAndNumber);
            $('#zip').val(data.address.zip);
            $('#municipality').val(data.address.municipality);
            $('#cardNumber').val(data.cardNumber);
            $('#cardValidityDateBegin').val(data.cardValidityDateBegin);
            $('#cardValidityDateEnd').val(data.cardValidityDateEnd);
            $('#idPhoto').attr("src", data.photo);
        }
        
//        eidData = {
//                firstName: $('#firstName').val(),
//                name : $('#name').val(),
//                middleName : $('#middleName').val(),
//                nationalNumber: $('#nationalNumber').val(),
//                dateOfBirth: $('#dateOfBirth').val(),
//                placeOfBirth: $('#placeOfBirth').val(),
//                nationality:$('#nationality').val(),
//                address: { 
//                    streetAndNumber:$('#streetAndNumber').val(),
//                    zip:$('#zip').val(),
//                    municipality:$('#municipality').val()
//                },
//                cardNumber:$('#cardNumber').val(),
//                cardValidityDateBegin:$('#cardValidityDateBegin').val(),
//                cardValidityDateEnd:$('#cardValidityDateEnd').val(),
//                photo: $('#idPhoto').attr('src')
//        };
//        
//        
//        
//        
//        $("#eidForm").on('submit',function(event){
//            event.preventDefault();
//            if ( $("#eidForm").serialize()){
//                $.ajax({
//                   url: '/api/eids/',
////                   data:  JSON.stringify(eidData),
//                   data:  JSON.stringify(eidData),
//                    
//                   beforeSend:function(xhr) {
//                       if ($.cookie('token')) {
//                          xhr.setRequestHeader('Authorization', 'Bearer ' + $.cookie('token'));
//                        }
//                    },
////                    headers: {'Authorization': 'Bearer ' + access_token},
//                   error: function() {
//                      
//                   },
//                   dataType: 'json',
//                   contentType: 'application/json',
//                   success: function(data) {
//                      alert(data);
//                   },
//                   type: 'POST'
//                });
//                
//                
//            }else{
//                
//            }
//        
//        });


    </script>

</body>

</html>